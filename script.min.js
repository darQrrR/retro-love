"use strict";const input=document.querySelector(".input"),output=document.querySelector(".output"),commands=[{cmd:"print",para:1,func:promptPrint},{cmd:"goto",para:1,func:promptGoto},{cmd:"exit",para:0,func:promptExit},{cmd:"clr",para:0,func:promptClr},{cmd:"run",para:0,func:promptRun}];let promptStorage=[];output.textContent="Ready.\n",input.addEventListener("input",(()=>{const t=input.value.length?input.value.length:1;input.setAttribute("size",t),input.style.width=0===input.value.length?"0px":"auto"})),input.addEventListener("blur",(()=>{input.focus()})),input.addEventListener("keydown",(t=>{if("Enter"===t.key){const t=input.value.toLowerCase().trim();output.textContent+=`${t}\n\n`;const e=t.match(/^\d+\s/),n=!!e?.[0],o=n?e[0].trim():null,p=n?t.slice(o.length+1):t,r=validatePrompt(p);if(!r.valid)return output.textContent+="?Syntax Error\n",void resetInput();if(n){const{fn:t,para:e}=r;storePrompt({lineNumber:o,fn:t,para:e})}n||(console.log("executing"),r.fn(r.para)),resetInput()}}));const validatePrompt=t=>{const e=t.indexOf(" ");let n,o;-1!==e?(n=t.slice(0,e),o=-1!==e?t.slice(e+1):null):(n=t,o=null);const p=commands.find((t=>t.cmd===n));if(!p)return!1;return{valid:!!(p.para&&o||!p.para&&!o),fn:p.func,para:o}},storePrompt=t=>{const e=promptStorage.findIndex((e=>e.lineNumber===t.lineNumber));-1!==e&&promptStorage.splice(e,1),promptStorage.push(t),promptStorage.sort(((t,e)=>t.lineNumber-e.lineNumber)),console.log(promptStorage)},resetInput=()=>{output.textContent+="Ready.\n",output.style.height=output.scrollHeight-24+"px",input.value="",input.style.width="0px"},clog=t=>{output.textContent+=`${t}\n`,output.style.height=output.scrollHeight-24+"px"},sleep=t=>new Promise((e=>setTimeout(e,t)));async function promptRun(){if(!promptStorage.length)return;const t=promptStorage.length;for(let e=0;e<t;e++){const n=promptStorage[e].fn(promptStorage[e].para);Number.isFinite(n)&&(e=n-1),e<t-1&&await sleep(250)}}function promptPrint(t){t&&(output.textContent+=`${t}\n`,output.style.height=output.scrollHeight-24+"px")}function promptGoto(t){const e=promptStorage.findIndex((e=>e.lineNumber===t));return console.log(`goto: ${t} -> ${e}`),e}function promptExit(){}function promptClr(){output.textContent="",output.style.height="0px",input.value="",input.style.width="0px"}