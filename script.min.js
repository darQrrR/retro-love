"use strict";import{stringybro}from"./src/js/utils/strings.js";const input=document.querySelector(".input"),output=document.querySelector(".output"),commands=[{cmd:"print",para:1,func:promptPrint},{cmd:"goto",para:1,func:promptGoto},{cmd:"input",para:1,func:promptInput},{cmd:"exit",para:0,func:promptExit},{cmd:"clr",para:0,func:promptClr},{cmd:"run",para:0,func:promptRun}];let promptStorage=[];const variables={A:123,AB:9,B:2,C:3,C$:"TEST","D%":3.1415};console.log(stringybro());const testData=['10 print "HELLO " + "WORLD"; A + 2.1; 40 + 2 4 * 3; C$; A, B, D%'];output.textContent="Ready.\n",input.addEventListener("input",(()=>{const t=input.value.length?input.value.length:1;input.setAttribute("size",t),input.style.width=0===input.value.length?"0px":"auto"})),input.addEventListener("blur",(()=>{input.focus()})),input.addEventListener("keydown",(t=>{if("Enter"===t.key){const t=input.value.toLowerCase().trim();input.value="",input.style.width="0px",output.textContent+=`${t}\n`,enterPrompt(t)}}));const enterPrompt=t=>{const e=t.match(/^\d+\s/),n=!!e?.[0],o=n?e[0].trim():null,p=n?t.slice(o.length+1):t,r=validatePrompt(p);if(!r.valid)return output.textContent+="\n?Syntax Error\n",void resetInput(!0);if(n){const{fn:t,para:e}=r;storePrompt({lineNumber:o,fn:t,para:e}),resetInput(!1)}n||r.fn(r.para).then((()=>{resetInput(!0)}))},validatePrompt=t=>{const e=t.indexOf(" ");let n,o;-1!==e?(n=t.slice(0,e),o=-1!==e?t.slice(e+1):null):(n=t,o=null);const p=commands.find((t=>t.cmd===n));if(!p)return!1;return{valid:!!(p.para&&o||!p.para&&!o),fn:p.func,para:o}},storePrompt=t=>{const e=promptStorage.findIndex((e=>e.lineNumber===t.lineNumber));-1!==e&&promptStorage.splice(e,1),promptStorage.push(t),promptStorage.sort(((t,e)=>t.lineNumber-e.lineNumber)),console.log(promptStorage)},resetInput=(t=!1)=>{t&&(output.textContent+="\nReady.\n"),output.style.height=output.scrollHeight-24+"px",output.scrollTop=output.scrollHeight-output.offsetHeight-24},clog=t=>{output.textContent+=`${t}\n`,output.style.height=output.scrollHeight-24+"px",output.scrollTop=output.scrollHeight-output.offsetHeight-24},sleep=t=>new Promise((e=>setTimeout(e,t)));async function promptRun(){if(!promptStorage.length)return;const t=promptStorage.length;for(let e=0;e<t;e++){const n=await promptStorage[e].fn(promptStorage[e].para);Number.isFinite(n)&&(e=n-1),e<t-1&&await sleep(100)}}async function promptPrint(t){t&&(output.textContent+=`${t}\n`,output.style.height=output.scrollHeight-24+"px",output.scrollTop=output.scrollHeight-output.offsetHeight-24)}async function promptGoto(t){return promptStorage.findIndex((e=>e.lineNumber===t))}async function promptInput(t){return t}async function promptExit(){}async function promptClr(){output.textContent="",output.style.height="0px",input.value="",input.style.width="0px"}if(void 0!==testData&&testData.length)for(let t=0;t<testData.length;t++)enterPrompt(testData[t]);